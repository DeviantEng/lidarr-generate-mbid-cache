# /data/config.ini
# Enhanced configuration for concurrent cache warming

[lidarr]
base_url = http://192.168.1.103:8686   # set to your ip/url
api_key  = REPLACE_WITH_YOUR_LIDARR_API_KEY

[probe]
# API endpoint to probe for each MBID
target_base_url = https://api.lidarr.audio/api/v0.4
timeout_seconds = 10

# Per-artist cache warming settings
max_attempts_per_artist = 25    # Try each artist up to 25 times to warm cache
delay_between_attempts = 0.5    # Wait 0.5 seconds between attempts for same artist

# Concurrent request settings
max_concurrent_requests = 5     # Number of simultaneous requests
rate_limit_per_second = 3       # Maximum API calls per second (safety valve)

# Circuit breaker settings (stops run if API is completely broken)
circuit_breaker_threshold = 25  # Stop after this many artists fail completely in a row
backoff_factor = 2.0           # How aggressively to back off on errors
max_backoff_seconds = 60       # Maximum wait time before retrying

[ledger]
csv_path = /data/mbids.csv

[run]
# Re-check successes if true (or pass --force to the script directly)
force = false

# Processing options (frequent saves for safety)
batch_size = 25                # Process in batches of 25 artists
batch_write_frequency = 5      # Save progress every 5 requests

[schedule]
# Run every N seconds (>=1). Example: 3600 = hourly
interval_seconds = 3600

# Run immediately when container starts (true/false)
run_at_start = true

# Optional: randomize pre-run delay each time, 0 to N seconds
jitter_seconds = 0

# Optional: stop after a certain number of runs (0 = unlimited)
max_runs = 50

[actions]
# Tell lidarr to refresh artist when MBID transitions from timeout/unknown -> success
update_lidarr = false

[monitoring]
log_progress_every_n = 25      # Report progress every N requests
log_level = INFO              # DEBUG, INFO, WARNING, ERROR
